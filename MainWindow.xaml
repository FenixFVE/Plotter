<Window x:Class="WpfPlotApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:scottplot="clr-namespace:ScottPlot.WPF;assembly=ScottPlot.WPF"
        xmlns:converters="clr-namespace:WpfPlotApp.Converters"
        xmlns:controls="clr-namespace:WpfPlotApp.Controls"
        xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
        Title="Ð ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€ Ð“Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð²" 
        Height="600" 
        Width="1000"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <converters:MarkerShapeConverter x:Key="MarkerShapeConverter"/>
        <converters:ColorConverter x:Key="ColorConverter"/>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:MultipleSelectionToVisibilityConverter x:Key="MultipleSelectionToVisibilityConverter"/>
        <converters:PrecisionConverter x:Key="PrecisionConverter"/>
        <converters:PointOrderConverter x:Key="PointOrderConverter"/>
        <converters:FunctionOrderConverter x:Key="FunctionOrderConverter"/>
        <converters:BooleanInverterConverter x:Key="BooleanInverterConverter"/>
        
        <!-- Ð¡Ñ‚Ð¸Ð»ÑŒ Ð´Ð»Ñ Ð·Ð°Ñ‚ÐµÐ¼Ð½ÐµÐ½Ð½Ñ‹Ñ… Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ‹Ñ… Ð¿Ð¾Ð»ÐµÐ¹ -->
        <Style x:Key="DisabledTextBoxStyle" TargetType="controls:PrecisionTextBox">
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#F0F0F0"/>
                    <Setter Property="Foreground" Value="#808080"/>
                    <Setter Property="BorderBrush" Value="#D0D0D0"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Ð¡Ñ‚Ð¸Ð»ÑŒ Ð´Ð»Ñ Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ñ… TextBox -->
        <Style x:Key="DisabledRegularTextBoxStyle" TargetType="TextBox">
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#F0F0F0"/>
                    <Setter Property="Foreground" Value="#808080"/>
                    <Setter Property="BorderBrush" Value="#D0D0D0"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="5"/>
            <ColumnDefinition Width="1*"/>
        </Grid.ColumnDefinitions>

        <!-- ÐžÐ±Ð»Ð°ÑÑ‚ÑŒ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ° -->
        <Border Grid.Column="0" 
                BorderBrush="Gray" 
                BorderThickness="1"
                Margin="10">
            <scottplot:WpfPlot x:Name="PlotControl"/>
        </Border>

        <!-- Ð Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÐµÐ»ÑŒ -->
        <GridSplitter Grid.Column="1" 
                      Width="5"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      Background="LightGray"/>

        <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ -->
        <Grid Grid.Column="2" 
              Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ñ‚Ð¾Ñ‡ÐºÐ°Ð¼Ð¸ -->
            <DockPanel Grid.Row="0">
            


            <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ ÐºÑƒÑ€ÑÐ¾Ñ€Ðµ -->
            <Border DockPanel.Dock="Top" 
                    BorderBrush="LightGray"
                    BorderThickness="1"
                    Padding="5"
                    Margin="0,0,0,10">
                <TextBlock x:Name="CursorInfoTextBlock"
                           Text="ÐšÑƒÑ€ÑÐ¾Ñ€: X=0.00, Y=0.00"
                           FontSize="12"
                           HorizontalAlignment="Center"/>
            </Border>



            <!-- Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¾Ð¼ -->
            <Border DockPanel.Dock="Top" 
                    BorderBrush="DarkGray"
                    BorderThickness="1"
                    Padding="8"
                    Margin="0,0,0,10">
                <StackPanel>
                    <TextBlock Text="ÐœÐ°ÑÑˆÑ‚Ð°Ð± Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°"
                               FontSize="12"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,8"/>
                    
                    <!-- ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ð¸ -->
                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" 
                                   Text="Ð¢Ð¾Ñ‡Ð½Ð¾ÑÑ‚ÑŒ (Ð·Ð½Ð°ÐºÐ¾Ð² Ð¿Ð¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑÑ‚Ð¾Ð¹):"
                                   VerticalAlignment="Center"
                                   Margin="0,0,5,0"/>
                        <TextBox Grid.Column="1"
                                 Text="{Binding Precision, UpdateSourceTrigger=PropertyChanged}"
                                 TextChanged="PrecisionTextBox_TextChanged"
                                 HorizontalAlignment="Left"
                                 Width="50"/>
                    </Grid>
                    
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- X Ð¾ÑÑŒ -->
                        <TextBlock Grid.Row="0" Grid.Column="0" 
                                   Text="X min:" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,5,5"/>
                        <controls:PrecisionTextBox Grid.Row="0" Grid.Column="1" 
                                                           x:Name="MinXTextBox"
                                                           NumericValue="{Binding MinX}"
                                                           Precision="{Binding Precision}"
                                                           TextChanged="AxisLimitTextBox_TextChanged"
                                                           Tag="MinX"
                                                           IsEnabled="{Binding LockX, Converter={StaticResource BooleanInverterConverter}}"
                                                           Style="{StaticResource DisabledTextBoxStyle}"
                                                           Margin="0,0,10,5"/>
                        
                        <TextBlock Grid.Row="0" Grid.Column="2" 
                                   Text="X max:" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,5,5"/>
                        <controls:PrecisionTextBox Grid.Row="0" Grid.Column="3" 
                                                   x:Name="MaxXTextBox"
                                                   NumericValue="{Binding MaxX}"
                                                   Precision="{Binding Precision}"
                                                   TextChanged="AxisLimitTextBox_TextChanged"
                                                   Tag="MaxX"
                                                   IsEnabled="{Binding LockX, Converter={StaticResource BooleanInverterConverter}}"
                                                   Style="{StaticResource DisabledTextBoxStyle}"
                                                   Margin="0,0,0,5"/>

                        <!-- Y Ð¾ÑÑŒ -->
                        <TextBlock Grid.Row="1" Grid.Column="0" 
                                   Text="Y min:" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,5,5"/>
                        <controls:PrecisionTextBox Grid.Row="1" Grid.Column="1" 
                                                   x:Name="MinYTextBox"
                                                   NumericValue="{Binding MinY}"
                                                   Precision="{Binding Precision}"
                                                   TextChanged="AxisLimitTextBox_TextChanged"
                                                   Tag="MinY"
                                                   IsEnabled="{Binding LockY, Converter={StaticResource BooleanInverterConverter}}"
                                                   Style="{StaticResource DisabledTextBoxStyle}"
                                                   Margin="0,0,10,5"/>
                        
                        <TextBlock Grid.Row="1" Grid.Column="2" 
                                   Text="Y max:" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,5,5"/>
                        <controls:PrecisionTextBox Grid.Row="1" Grid.Column="3" 
                                                   x:Name="MaxYTextBox"
                                                   NumericValue="{Binding MaxY}"
                                                   Precision="{Binding Precision}"
                                                   TextChanged="AxisLimitTextBox_TextChanged"
                                                   Tag="MaxY"
                                                   IsEnabled="{Binding LockY, Converter={StaticResource BooleanInverterConverter}}"
                                                   Style="{StaticResource DisabledTextBoxStyle}"
                                                   Margin="0,0,0,5"/>

                        <!-- Ð‘Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ¸ Ð¾ÑÐµÐ¹ -->
                        <CheckBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" 
                                  IsChecked="{Binding LockX}" 
                                  Content="ðŸ”’ Ð‘Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ X" 
                                  ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð¸ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾ Ð¾ÑÐ¸ X"
                                  Margin="0,5,10,0"
                                  Checked="AxisLockCheckBox_Changed"
                                  Unchecked="AxisLockCheckBox_Changed"/>
                        
                        <CheckBox Grid.Row="2" Grid.Column="2" Grid.ColumnSpan="2" 
                                  IsChecked="{Binding LockY}" 
                                  Content="ðŸ”’ Ð‘Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Y" 
                                  ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð¸ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾ Ð¾ÑÐ¸ Y"
                                  Margin="0,5,0,0"
                                  Checked="AxisLockCheckBox_Changed"
                                  Unchecked="AxisLockCheckBox_Changed"/>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
            <StackPanel DockPanel.Dock="Top" 
                        Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        Margin="0,0,0,10">
                <Button x:Name="SaveProjectButton"
                        Content="ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"
                        Click="SaveProjectButton_Click"
                        Margin="0,0,5,0"
                        Padding="10,5"
                        ToolTip="Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð² JSON Ñ„Ð°Ð¹Ð»"/>
                <Button x:Name="LoadProjectButton"
                        Content="ðŸ“ Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ"
                        Click="LoadProjectButton_Click"
                        Margin="0,0,5,0"
                        Padding="10,5"
                        ToolTip="Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð¸Ð· JSON Ñ„Ð°Ð¹Ð»Ð°"/>
                <Button x:Name="NewProjectButton"
                        Content="ðŸ“„ ÐÐ¾Ð²Ñ‹Ð¹"
                        Click="NewProjectButton_Click"
                        Padding="10,5"
                        ToolTip="Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ (Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð²ÑÑ‘)"/>
            </StackPanel>

            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð´Ð»Ñ Ñ‚Ð¾Ñ‡ÐµÐº -->
            <TextBlock DockPanel.Dock="Top" 
                       Text="Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ‚Ð¾Ñ‡ÐºÐ°Ð¼Ð¸"
                       FontSize="16"
                       FontWeight="Bold"
                       Margin="0,0,0,5"
                       HorizontalAlignment="Center"/>

            <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð²Ñ‹Ð±Ð¾Ñ€Ðµ -->
            <Border DockPanel.Dock="Top" 
                    BorderBrush="LightBlue"
                    BorderThickness="1"
                    Padding="5"
                    Margin="0,0,0,10"
                    Visibility="{Binding HasSelectedPoints, Converter={StaticResource BooleanToVisibilityConverter}}">
                <TextBlock Text="{Binding SelectedPointsCount, StringFormat='Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð¾ Ñ‚Ð¾Ñ‡ÐµÐº: {0}'}"
                           FontSize="12"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           Foreground="Blue"/>
            </Border>

            <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ -->
            <StackPanel DockPanel.Dock="Top" 
                        Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        Margin="0,0,0,10">
                <Button x:Name="AddPointButton"
                        Content="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ñ‡ÐºÑƒ"
                        Click="AddPointButton_Click"
                        Margin="0,0,5,0"
                        Padding="10,5"/>
                <Button x:Name="RemovePointButton"
                        Content="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ"
                        Click="RemoveSelectedPointsButton_Click"
                        Margin="0,0,5,0"
                        Padding="10,5"
                        IsEnabled="{Binding HasSelectedPoints}"/>
                <Button x:Name="RecalculateExpressionsButton"
                        Content="ðŸ”„ ÐŸÐµÑ€ÐµÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ð²ÑÑ‘"
                        Click="RecalculateExpressionsButton_Click"
                        Padding="10,5"
                        ToolTip="ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿ÐµÑ€ÐµÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸"/>
            </StackPanel>

            <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‚Ð¾Ñ‡ÐµÐº -->
            <Border BorderBrush="Gray" 
                    BorderThickness="1">
                <ListBox x:Name="PointsListBox"
                         ItemsSource="{Binding Points}" 
                         SelectedItem="{Binding SelectedPoint}"
                         SelectionMode="Extended"
                         Background="White"
                         SelectionChanged="PointsListBox_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="LightGray" 
                                    BorderThickness="0,0,0,1" 
                                    Padding="5"
                                    Margin="0,0,0,2">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ñ Ñ‚Ð¾Ñ‡ÐµÐº -->
                                    <StackPanel Grid.Column="0" 
                                                Orientation="Vertical"
                                                VerticalAlignment="Center"
                                                Margin="0,0,5,0">
                                        <Button Content="â–²"
                                                Click="MovePointUpButton_Click"
                                                Width="20"
                                                Height="20"
                                                Margin="0,0,0,2"
                                                FontSize="10"
                                                ToolTip="ÐŸÐµÑ€ÐµÐ¼ÐµÑÑ‚Ð¸Ñ‚ÑŒ Ð²Ð²ÐµÑ€Ñ… (Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ð¿Ñ€Ð¸ Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ð¾Ð¼ Ð²Ñ‹Ð´ÐµÐ»ÐµÐ½Ð¸Ð¸)">
                                            <Button.IsEnabled>
                                                <MultiBinding Converter="{StaticResource PointOrderConverter}" ConverterParameter="Up">
                                                    <Binding Path="."/>
                                                    <Binding RelativeSource="{RelativeSource AncestorType=ListBox}" Path="DataContext.Points"/>
                                                    <Binding RelativeSource="{RelativeSource AncestorType=ListBox}" Path="DataContext.SelectedPointsCount"/>
                                                </MultiBinding>
                                            </Button.IsEnabled>
                                        </Button>
                                        <Button Content="â–¼"
                                                Click="MovePointDownButton_Click"
                                                Width="20"
                                                Height="20"
                                                FontSize="10"
                                                ToolTip="ÐŸÐµÑ€ÐµÐ¼ÐµÑÑ‚Ð¸Ñ‚ÑŒ Ð²Ð½Ð¸Ð· (Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ð¿Ñ€Ð¸ Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ð¾Ð¼ Ð²Ñ‹Ð´ÐµÐ»ÐµÐ½Ð¸Ð¸)">
                                            <Button.IsEnabled>
                                                <MultiBinding Converter="{StaticResource PointOrderConverter}" ConverterParameter="Down">
                                                    <Binding Path="."/>
                                                    <Binding RelativeSource="{RelativeSource AncestorType=ListBox}" Path="DataContext.Points"/>
                                                    <Binding RelativeSource="{RelativeSource AncestorType=ListBox}" Path="DataContext.SelectedPointsCount"/>
                                                </MultiBinding>
                                            </Button.IsEnabled>
                                        </Button>
                                    </StackPanel>
                                    
                                    <Expander Grid.Column="1"
                                              IsExpanded="{Binding IsExpanded}"
                                              Header="{Binding Name, Converter={StaticResource PointNameDisplayConverter}}"
                                              Margin="0">
                                        <Expander.Content>
                                    <StackPanel Margin="10,5,0,5">
                                        <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ð¾Ð³Ð¾ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ -->
                                        <TextBlock Text="ðŸ”— Ð“Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ð¾Ðµ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾"
                                                   FontSize="10"
                                                   FontStyle="Italic"
                                                   Foreground="Blue"
                                                   HorizontalAlignment="Center"
                                                   Margin="0,0,0,5">
                                            <TextBlock.Visibility>
                                                <MultiBinding Converter="{StaticResource MultipleSelectionToVisibilityConverter}">
                                                    <Binding RelativeSource="{RelativeSource AncestorType=ListBox}" Path="DataContext.SelectedPointsCount"/>
                                                    <Binding Path="."/>
                                                    <Binding RelativeSource="{RelativeSource AncestorType=ListBox}" Path="SelectedItems"/>
                                                </MultiBinding>
                                            </TextBlock.Visibility>
                                        </TextBlock>
                                        
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="120"/>
                                                <ColumnDefinition Width="120"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ð¾Ñ‡ÐºÐ¸ -->
                                            <CheckBox Grid.Row="0" 
                                                      Grid.Column="0"
                                                      IsChecked="{Binding LockName}"
                                                      ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ"
                                                      VerticalAlignment="Center"
                                                      Content="ðŸ”’"
                                                      Margin="0,0,5,5"/>
                                            <TextBlock Grid.Row="0" 
                                                       Grid.Column="1"
                                                       Text="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ:"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,5,5"/>
                                            <TextBox Grid.Row="0" 
                                                     Grid.Column="2"
                                                     Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                                     TextChanged="NameTextBox_TextChanged"
                                                     IsEnabled="{Binding LockName, Converter={StaticResource BooleanInverterConverter}}"
                                                     Style="{StaticResource DisabledRegularTextBoxStyle}"
                                                     ToolTip="Ð˜Ð¼Ñ Ñ‚Ð¾Ñ‡ÐºÐ¸ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð±ÑƒÐºÐ²Ñ‹, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: A, B, AA, AB)"
                                                     Margin="0,0,0,5"/>

                                            <!-- X ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ð° -->
                                            <CheckBox Grid.Row="1" 
                                                      Grid.Column="0"
                                                      IsChecked="{Binding LockX}"
                                                      ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ X ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñƒ"
                                                      VerticalAlignment="Center"
                                                      Content="ðŸ”’"
                                                      Margin="0,0,5,5"/>
                                            <TextBlock Grid.Row="1" 
                                                       Grid.Column="1"
                                                       Text="X:"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,5,5"/>
                                            <controls:PrecisionTextBox Grid.Row="1" 
                                                                       Grid.Column="2"
                                                                       NumericValue="{Binding X}"
                                                                       Precision="{Binding DataContext.Precision, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                       TextChanged="XTextBox_TextChanged"
                                                                       IsEnabled="{Binding LockX, Converter={StaticResource BooleanInverterConverter}}"
                                                                       Style="{StaticResource DisabledTextBoxStyle}"
                                                                       Margin="0,0,5,5"/>
                                            <TextBox Grid.Row="1" 
                                                     Grid.Column="3"
                                                     Name="XExpressionTextBox"
                                                     Text="{Binding XExpression, UpdateSourceTrigger=PropertyChanged}"
                                                     TextChanged="XExpressionTextBox_TextChanged"
                                                     ToolTip="Ð’Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ X (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: B.X, C.Y)"
                                                     Margin="0,0,0,5"/>

                                            <!-- Y ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ð° -->
                                            <CheckBox Grid.Row="2" 
                                                      Grid.Column="0"
                                                      IsChecked="{Binding LockY}"
                                                      ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Y ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñƒ"
                                                      VerticalAlignment="Center"
                                                      Content="ðŸ”’"
                                                      Margin="0,0,5,5"/>
                                            <TextBlock Grid.Row="2" 
                                                       Grid.Column="1"
                                                       Text="Y:"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,5,5"/>
                                            <controls:PrecisionTextBox Grid.Row="2" 
                                                                       Grid.Column="2"
                                                                       NumericValue="{Binding Y}"
                                                                       Precision="{Binding DataContext.Precision, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                       TextChanged="YTextBox_TextChanged"
                                                                       IsEnabled="{Binding LockY, Converter={StaticResource BooleanInverterConverter}}"
                                                                       Style="{StaticResource DisabledTextBoxStyle}"
                                                                       Margin="0,0,5,5"/>
                                            <TextBox Grid.Row="2" 
                                                     Grid.Column="3"
                                                     Name="YExpressionTextBox"
                                                     Text="{Binding YExpression, UpdateSourceTrigger=PropertyChanged}"
                                                     TextChanged="YExpressionTextBox_TextChanged"
                                                     ToolTip="Ð’Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Y (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: A.Y, B.X)"
                                                     Margin="0,0,0,5"/>

                                            <!-- Ð Ð°Ð·Ð¼ÐµÑ€ -->
                                            <CheckBox Grid.Row="3" 
                                                      Grid.Column="0"
                                                      IsChecked="{Binding LockSize}"
                                                      ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ€Ð°Ð·Ð¼ÐµÑ€"
                                                      VerticalAlignment="Center"
                                                      Content="ðŸ”’"
                                                      Margin="0,0,5,5"/>
                                            <TextBlock Grid.Row="3" 
                                                       Grid.Column="1"
                                                       Text="Ð Ð°Ð·Ð¼ÐµÑ€:"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,5,5"/>
                                            <TextBox Grid.Row="3" 
                                                     Grid.Column="2"
                                                     Text="{Binding MarkerSize, UpdateSourceTrigger=PropertyChanged}" 
                                                     TextChanged="SizeTextBox_TextChanged"
                                                     IsEnabled="{Binding LockSize, Converter={StaticResource BooleanInverterConverter}}"
                                                     Style="{StaticResource DisabledRegularTextBoxStyle}"
                                                     Margin="0,0,0,5"/>

                                            <!-- Ð¤Ð¾Ñ€Ð¼Ð° -->
                                            <CheckBox Grid.Row="4" 
                                                      Grid.Column="0"
                                                      IsChecked="{Binding LockShape}"
                                                      ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ„Ð¾Ñ€Ð¼Ñƒ"
                                                      VerticalAlignment="Center"
                                                      Content="ðŸ”’"
                                                      Margin="0,0,5,5"/>
                                            <TextBlock Grid.Row="4" 
                                                       Grid.Column="1"
                                                       Text="Ð¤Ð¾Ñ€Ð¼Ð°:"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,5,5"/>
                                            <ComboBox Grid.Row="4" 
                                                      Grid.Column="2"
                                                      SelectedValue="{Binding MarkerShape, Converter={StaticResource MarkerShapeConverter}}"
                                                      SelectedValuePath="Tag"
                                                      SelectionChanged="ShapeComboBox_SelectionChanged"
                                                      IsEnabled="{Binding LockShape, Converter={StaticResource BooleanInverterConverter}}"
                                                      Margin="0,0,0,5">
                                                <ComboBoxItem Content="ÐšÑ€ÑƒÐ³" Tag="FilledCircle"/>
                                                <ComboBoxItem Content="ÐšÐ²Ð°Ð´Ñ€Ð°Ñ‚" Tag="FilledSquare"/>
                                                <ComboBoxItem Content="Ð Ð¾Ð¼Ð±" Tag="FilledDiamond"/>
                                                <ComboBoxItem Content="ÐŸÑƒÑÑ‚Ð¾Ð¹ ÐºÑ€ÑƒÐ³" Tag="OpenCircle"/>
                                                <ComboBoxItem Content="ÐŸÑƒÑÑ‚Ð¾Ð¹ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚" Tag="OpenSquare"/>
                                            </ComboBox>

                                            <!-- Ð¦Ð²ÐµÑ‚ -->
                                            <CheckBox Grid.Row="5" 
                                                      Grid.Column="0"
                                                      IsChecked="{Binding LockColor}"
                                                      ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ†Ð²ÐµÑ‚"
                                                      VerticalAlignment="Center"
                                                      Content="ðŸ”’"
                                                      Margin="0,0,5,5"/>
                                            <TextBlock Grid.Row="5" 
                                                       Grid.Column="1"
                                                       Text="Ð¦Ð²ÐµÑ‚:"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,5,5"/>
                                            <xctk:ColorPicker Grid.Row="5" 
                                                              Grid.Column="2"
                                                              SelectedColor="{Binding Color, Converter={StaticResource ColorConverter}}"
                                                              DisplayColorAndName="True"
                                                              ShowRecentColors="True" 
                                                              ShowStandardColors="True"
                                                              ShowAvailableColors="True"
                                                              ShowDropDownButton="True"
                                                              ColorMode="ColorPalette"
                                                              UsingAlphaChannel="True"
                                                              SelectedColorChanged="ColorPicker_SelectedColorChanged"
                                                              IsEnabled="{Binding LockColor, Converter={StaticResource BooleanInverterConverter}}"
                                                              Width="150"
                                                              Height="25"/>
                                        </Grid>
                                    </StackPanel>
                                        </Expander.Content>
                                    </Expander>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Border>
            
            </DockPanel>
            
            <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼Ð¸ -->
            <!-- Ð Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÐµÐ»ÑŒ Ð¼ÐµÐ¶Ð´Ñƒ ÑÐµÐºÑ†Ð¸ÑÐ¼Ð¸ -->
            <GridSplitter Grid.Row="1"
                         Height="8"
                         Background="LightGray"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Center"
                         ShowsPreview="True"
                         Cursor="SizeNS"/>
            
            <DockPanel Grid.Row="2">
            
            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð´Ð»Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ -->
            <TextBlock DockPanel.Dock="Top" 
                       Text="Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼Ð¸"
                       FontSize="16"
                       FontWeight="Bold"
                       Margin="0,20,0,10"
                       HorizontalAlignment="Center"/>

            <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð²Ñ‹Ð±Ð¾Ñ€Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ -->
            <Border DockPanel.Dock="Top" 
                    BorderBrush="LightGreen"
                    BorderThickness="1"
                    Padding="5"
                    Margin="0,0,0,10"
                    Visibility="{Binding HasSelectedFunctions, Converter={StaticResource BooleanToVisibilityConverter}}">
                <TextBlock Text="{Binding SelectedFunctionsCount, StringFormat='Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð¾ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹: {0}'}"
                           FontSize="12"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           Foreground="Green"/>
            </Border>

            <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼Ð¸ -->
            <StackPanel DockPanel.Dock="Top" 
                        Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        Margin="0,0,0,10">
                <Button x:Name="AddFunctionButton"
                        Content="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ"
                        Click="AddFunctionButton_Click"
                        Margin="0,0,5,0"
                        Padding="10,5"/>
                <Button x:Name="RemoveFunctionButton"
                        Content="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ"
                        Click="RemoveSelectedFunctionsButton_Click"
                        Margin="0,0,5,0"
                        Padding="10,5"
                        IsEnabled="{Binding HasSelectedFunctions}"/>
            </StackPanel>

            <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ -->
            <Border BorderBrush="Gray" 
                    BorderThickness="1">
                <ListBox x:Name="FunctionsListBox"
                         ItemsSource="{Binding Functions}" 
                         SelectedItem="{Binding SelectedFunction}"
                         SelectionMode="Extended"
                         Background="White"
                         SelectionChanged="FunctionsListBox_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="LightGray" 
                                    BorderThickness="0,0,0,1" 
                                    Padding="5"
                                    Margin="0,0,0,2">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ -->
                                    <StackPanel Grid.Column="0" 
                                                Orientation="Vertical"
                                                VerticalAlignment="Center"
                                                Margin="0,0,5,0">
                                        <Button Content="â–²"
                                                Click="MoveFunctionUpButton_Click"
                                                Width="20"
                                                Height="20"
                                                Margin="0,0,0,2"
                                                FontSize="10"
                                                ToolTip="ÐŸÐµÑ€ÐµÐ¼ÐµÑÑ‚Ð¸Ñ‚ÑŒ Ð²Ð²ÐµÑ€Ñ… (Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ð¿Ñ€Ð¸ Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ð¾Ð¼ Ð²Ñ‹Ð´ÐµÐ»ÐµÐ½Ð¸Ð¸)">
                                            <Button.IsEnabled>
                                                <MultiBinding Converter="{StaticResource FunctionOrderConverter}" ConverterParameter="Up">
                                                    <Binding Path="."/>
                                                    <Binding RelativeSource="{RelativeSource AncestorType=ListBox}" Path="DataContext.Functions"/>
                                                    <Binding RelativeSource="{RelativeSource AncestorType=ListBox}" Path="DataContext.SelectedFunctionsCount"/>
                                                </MultiBinding>
                                            </Button.IsEnabled>
                                        </Button>
                                        <Button Content="â–¼"
                                                Click="MoveFunctionDownButton_Click"
                                                Width="20"
                                                Height="20"
                                                FontSize="10"
                                                ToolTip="ÐŸÐµÑ€ÐµÐ¼ÐµÑÑ‚Ð¸Ñ‚ÑŒ Ð²Ð½Ð¸Ð· (Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ð¿Ñ€Ð¸ Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ð¾Ð¼ Ð²Ñ‹Ð´ÐµÐ»ÐµÐ½Ð¸Ð¸)">
                                            <Button.IsEnabled>
                                                <MultiBinding Converter="{StaticResource FunctionOrderConverter}" ConverterParameter="Down">
                                                    <Binding Path="."/>
                                                    <Binding RelativeSource="{RelativeSource AncestorType=ListBox}" Path="DataContext.Functions"/>
                                                    <Binding RelativeSource="{RelativeSource AncestorType=ListBox}" Path="DataContext.SelectedFunctionsCount"/>
                                                </MultiBinding>
                                            </Button.IsEnabled>
                                        </Button>
                                    </StackPanel>
                                    
                                    <Expander Grid.Column="1"
                                              IsExpanded="{Binding IsExpanded}"
                                              Header="{Binding Name}"
                                              Margin="0">
                                        <Expander.Content>
                                            <StackPanel Margin="10,5,0,5">
                                                <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ð¾Ð³Ð¾ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ -->
                                                <TextBlock Text="ðŸ”— Ð“Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ð¾Ðµ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾"
                                                           FontSize="10"
                                                           FontStyle="Italic"
                                                           Foreground="Blue"
                                                           HorizontalAlignment="Center"
                                                           Margin="0,0,0,5">
                                                    <TextBlock.Visibility>
                                                        <MultiBinding Converter="{StaticResource MultipleSelectionToVisibilityConverter}">
                                                            <Binding RelativeSource="{RelativeSource AncestorType=ListBox}" Path="DataContext.SelectedFunctionsCount"/>
                                                            <Binding Path="."/>
                                                            <Binding RelativeSource="{RelativeSource AncestorType=ListBox}" Path="SelectedItems"/>
                                                        </MultiBinding>
                                                    </TextBlock.Visibility>
                                                </TextBlock>
                                                
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="200"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ -->
                                                    <CheckBox Grid.Row="0" 
                                                              Grid.Column="0"
                                                              IsChecked="{Binding LockName}"
                                                              ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ"
                                                              VerticalAlignment="Center"
                                                              Content="ðŸ”’"
                                                              Margin="0,0,5,5"/>
                                                    <TextBlock Grid.Row="0" 
                                                               Grid.Column="1"
                                                               Text="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ:"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,5,5"/>
                                                    <TextBox Grid.Row="0" 
                                                             Grid.Column="2"
                                                             Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                                             TextChanged="FunctionNameTextBox_TextChanged"
                                                             IsEnabled="{Binding LockName, Converter={StaticResource BooleanInverterConverter}}"
                                                             ToolTip="Ð˜Ð¼Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: f1, f2, g)"
                                                             Margin="0,0,0,5"/>

                                                    <!-- Ð’Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ -->
                                                    <CheckBox Grid.Row="1" 
                                                              Grid.Column="0"
                                                              IsChecked="{Binding LockExpression}"
                                                              ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ"
                                                              VerticalAlignment="Center"
                                                              Content="ðŸ”’"
                                                              Margin="0,0,5,5"/>
                                                    <TextBlock Grid.Row="1" 
                                                               Grid.Column="1"
                                                               Text="Ð’Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ:"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,5,5"/>
                                                    <TextBox Grid.Row="1" 
                                                             Grid.Column="2"
                                                             Text="{Binding Expression, UpdateSourceTrigger=PropertyChanged}"
                                                             TextChanged="FunctionExpressionTextBox_TextChanged"
                                                             IsEnabled="{Binding LockExpression, Converter={StaticResource BooleanInverterConverter}}"
                                                             ToolTip="ÐœÐ°Ñ‚ÐµÐ¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: sin(x), x^2, A.X + x)"
                                                             Margin="0,0,0,5"/>

                                                    <!-- ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ -->
                                                    <CheckBox Grid.Row="2" 
                                                              Grid.Column="1"
                                                              Grid.ColumnSpan="2"
                                                              IsChecked="{Binding IsVisible}"
                                                              Content="ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°Ñ‚ÑŒ Ð½Ð° Ð³Ñ€Ð°Ñ„Ð¸ÐºÐµ"
                                                              ToolTip="ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ/ÑÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ Ð½Ð° Ð³Ñ€Ð°Ñ„Ð¸ÐºÐµ"
                                                              Margin="0,0,0,5"/>

                                                    <!-- Min X -->
                                                    <CheckBox Grid.Row="3" 
                                                              Grid.Column="0"
                                                              IsChecked="{Binding LockMinX}"
                                                              ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ X"
                                                              VerticalAlignment="Center"
                                                              Content="ðŸ”’"
                                                              Margin="0,0,5,5"/>
                                                    <TextBlock Grid.Row="3" 
                                                               Grid.Column="1"
                                                               Text="Min X:"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,5,5"/>
                                                    <TextBox Grid.Row="3" 
                                                             Grid.Column="2"
                                                             Text="{Binding MinX, UpdateSourceTrigger=PropertyChanged}"
                                                             TextChanged="FunctionMinXTextBox_TextChanged"
                                                             IsEnabled="{Binding LockMinX, Converter={StaticResource BooleanInverterConverter}}"
                                                             ToolTip="ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ X Ð´Ð»Ñ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐ¸"
                                                             Margin="0,0,0,5"/>

                                                    <!-- Max X -->
                                                    <CheckBox Grid.Row="4" 
                                                              Grid.Column="0"
                                                              IsChecked="{Binding LockMaxX}"
                                                              ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ X"
                                                              VerticalAlignment="Center"
                                                              Content="ðŸ”’"
                                                              Margin="0,0,5,5"/>
                                                    <TextBlock Grid.Row="4" 
                                                               Grid.Column="1"
                                                               Text="Max X:"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,5,5"/>
                                                    <TextBox Grid.Row="4" 
                                                             Grid.Column="2"
                                                             Text="{Binding MaxX, UpdateSourceTrigger=PropertyChanged}"
                                                             TextChanged="FunctionMaxXTextBox_TextChanged"
                                                             IsEnabled="{Binding LockMaxX, Converter={StaticResource BooleanInverterConverter}}"
                                                             ToolTip="ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ X Ð´Ð»Ñ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐ¸"
                                                             Margin="0,0,0,5"/>

                                                    <!-- ÐÐ²Ñ‚Ð¾Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ -->
                                                    <CheckBox Grid.Row="5" 
                                                              Grid.Column="1"
                                                              Grid.ColumnSpan="2"
                                                              IsChecked="{Binding AutoScale}"
                                                              Content="ÐÐ²Ñ‚Ð¾Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ X"
                                                              ToolTip="Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼Ð°ÑÑˆÑ‚Ð°Ð± ÑÐºÑ€Ð°Ð½Ð° Ð´Ð»Ñ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð° X"
                                                              Margin="0,0,0,5"/>

                                                    <!-- Min Y -->
                                                    <CheckBox Grid.Row="6" 
                                                              Grid.Column="0"
                                                              IsChecked="{Binding LockMinY}"
                                                              ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ Y"
                                                              VerticalAlignment="Center"
                                                              Content="ðŸ”’"
                                                              Margin="0,0,5,5"/>
                                                    <TextBlock Grid.Row="6" 
                                                               Grid.Column="1"
                                                               Text="Min Y:"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,5,5"/>
                                                    <TextBox Grid.Row="6" 
                                                             Grid.Column="2"
                                                             Text="{Binding MinY, UpdateSourceTrigger=PropertyChanged}"
                                                             TextChanged="FunctionMinYTextBox_TextChanged"
                                                             IsEnabled="{Binding LockMinY, Converter={StaticResource BooleanInverterConverter}}"
                                                             ToolTip="ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Y Ð´Ð»Ñ Ð½ÐµÑÐ²Ð½Ñ‹Ñ… ÐºÑ€Ð¸Ð²Ñ‹Ñ…"
                                                             Margin="0,0,0,5"/>

                                                    <!-- Max Y -->
                                                    <CheckBox Grid.Row="7" 
                                                              Grid.Column="0"
                                                              IsChecked="{Binding LockMaxY}"
                                                              ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ Y"
                                                              VerticalAlignment="Center"
                                                              Content="ðŸ”’"
                                                              Margin="0,0,5,5"/>
                                                    <TextBlock Grid.Row="7" 
                                                               Grid.Column="1"
                                                               Text="Max Y:"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,5,5"/>
                                                    <TextBox Grid.Row="7" 
                                                             Grid.Column="2"
                                                             Text="{Binding MaxY, UpdateSourceTrigger=PropertyChanged}"
                                                             TextChanged="FunctionMaxYTextBox_TextChanged"
                                                             IsEnabled="{Binding LockMaxY, Converter={StaticResource BooleanInverterConverter}}"
                                                             ToolTip="ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Y Ð´Ð»Ñ Ð½ÐµÑÐ²Ð½Ñ‹Ñ… ÐºÑ€Ð¸Ð²Ñ‹Ñ…"
                                                             Margin="0,0,0,5"/>

                                                    <!-- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² -->
                                                    <CheckBox Grid.Row="8" 
                                                              Grid.Column="0"
                                                              IsChecked="{Binding LockArgumentCount}"
                                                              ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²"
                                                              VerticalAlignment="Center"
                                                              Content="ðŸ”’"
                                                              Margin="0,0,5,5"/>
                                                    <TextBlock Grid.Row="8" 
                                                               Grid.Column="1"
                                                               Text="ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,5,5"/>
                                                    <TextBox Grid.Row="8" 
                                                             Grid.Column="2"
                                                             Text="{Binding ArgumentCount, UpdateSourceTrigger=PropertyChanged}"
                                                             TextChanged="FunctionArgumentCountTextBox_TextChanged"
                                                             IsEnabled="{Binding LockArgumentCount, Converter={StaticResource BooleanInverterConverter}}"
                                                             ToolTip="ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ (1-5)"
                                                             Margin="0,0,0,5"/>

                                                    <!-- Ð˜Ð¼ÐµÐ½Ð° Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² -->
                                                    <CheckBox Grid.Row="9" 
                                                              Grid.Column="0"
                                                              IsChecked="{Binding LockArgumentNames}"
                                                              ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ð¼ÐµÐ½Ð° Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²"
                                                              VerticalAlignment="Center"
                                                              Content="ðŸ”’"
                                                              Margin="0,0,5,5"/>
                                                    <TextBlock Grid.Row="9" 
                                                               Grid.Column="1"
                                                               Text="Ð˜Ð¼ÐµÐ½Ð° Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²:"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,5,5"/>
                                                    <TextBox Grid.Row="9" 
                                                             Grid.Column="2"
                                                             Text="{Binding ArgumentNames, UpdateSourceTrigger=PropertyChanged}"
                                                             TextChanged="FunctionArgumentNamesTextBox_TextChanged"
                                                             IsEnabled="{Binding LockArgumentNames, Converter={StaticResource BooleanInverterConverter}}"
                                                             ToolTip="Ð˜Ð¼ÐµÐ½Ð° Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ñ‡ÐµÑ€ÐµÐ· Ð·Ð°Ð¿ÑÑ‚ÑƒÑŽ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: x,y,z)"
                                                             Margin="0,0,0,5"/>

                                                    <!-- ÐÐµÑÐ²Ð½Ð°Ñ ÐºÑ€Ð¸Ð²Ð°Ñ -->
                                                    <CheckBox Grid.Row="10" 
                                                              Grid.Column="1"
                                                              Grid.ColumnSpan="2"
                                                              IsChecked="{Binding IsImplicitCurve}"
                                                              Content="ÐÐµÑÐ²Ð½Ð°Ñ ÐºÑ€Ð¸Ð²Ð°Ñ"
                                                              ToolTip="Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð»Ñ Ð½ÐµÑÐ²Ð½Ñ‹Ñ… ÐºÑ€Ð¸Ð²Ñ‹Ñ… (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: x^2 + y^2 = 1)"
                                                              Margin="0,0,0,5"
                                                              Checked="FunctionIsImplicitCurveCheckBox_Changed"
                                                              Unchecked="FunctionIsImplicitCurveCheckBox_Changed"/>

                                                    <!-- Ð ÐµÐ¶Ð¸Ð¼ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸ -->
                                                    <CheckBox Grid.Row="11" 
                                                              Grid.Column="1"
                                                              Grid.ColumnSpan="2"
                                                              IsChecked="{Binding PerformanceMode}"
                                                              Content="âš¡ Ð ÐµÐ¶Ð¸Ð¼ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸"
                                                              ToolTip="Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐ° Ð½ÐµÑÐ²Ð½Ñ‹Ñ… ÐºÑ€Ð¸Ð²Ñ‹Ñ… Ñ Ð½Ð¸Ð·ÐºÐ¸Ð¼ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾Ð¼"
                                                              Margin="0,0,0,5"
                                                              IsEnabled="{Binding IsImplicitCurve}"
                                                              Checked="FunctionPerformanceModeCheckBox_Changed"
                                                              Unchecked="FunctionPerformanceModeCheckBox_Changed"/>

                                                    <!-- Ð¦Ð²ÐµÑ‚ Ð»Ð¸Ð½Ð¸Ð¸ -->
                                                    <CheckBox Grid.Row="12" 
                                                              Grid.Column="0"
                                                              IsChecked="{Binding LockColor}"
                                                              ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ†Ð²ÐµÑ‚"
                                                              VerticalAlignment="Center"
                                                              Content="ðŸ”’"
                                                              Margin="0,0,5,5"/>
                                                    <TextBlock Grid.Row="12" 
                                                               Grid.Column="1"
                                                               Text="Ð¦Ð²ÐµÑ‚:"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,5,5"/>
                                                    <xctk:ColorPicker Grid.Row="12" 
                                                                      Grid.Column="2"
                                                                      SelectedColor="{Binding Color, Converter={StaticResource ColorConverter}}"
                                                                      DisplayColorAndName="True"
                                                                      ShowRecentColors="True" 
                                                                      ShowStandardColors="True"
                                                                      ShowAvailableColors="True"
                                                                      ShowDropDownButton="True"
                                                                      ColorMode="ColorPalette"
                                                                      UsingAlphaChannel="True"
                                                                      SelectedColorChanged="FunctionColorPicker_SelectedColorChanged"
                                                                      IsEnabled="{Binding LockColor, Converter={StaticResource BooleanInverterConverter}}"
                                                                      Width="120"
                                                                      Height="25"
                                                                      Margin="0,0,0,5"/>

                                                    <!-- Ð¨Ð¸Ñ€Ð¸Ð½Ð° Ð»Ð¸Ð½Ð¸Ð¸ -->
                                                    <CheckBox Grid.Row="13" 
                                                              Grid.Column="0"
                                                              IsChecked="{Binding LockLineWidth}"
                                                              ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑˆÐ¸Ñ€Ð¸Ð½Ñƒ Ð»Ð¸Ð½Ð¸Ð¸"
                                                              VerticalAlignment="Center"
                                                              Content="ðŸ”’"
                                                              Margin="0,0,5,5"/>
                                                    <TextBlock Grid.Row="13" 
                                                               Grid.Column="1"
                                                               Text="Ð¨Ð¸Ñ€Ð¸Ð½Ð° Ð»Ð¸Ð½Ð¸Ð¸:"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,5,5"/>
                                                    <TextBox Grid.Row="13" 
                                                             Grid.Column="2"
                                                             Text="{Binding LineWidth, UpdateSourceTrigger=PropertyChanged}"
                                                             TextChanged="FunctionLineWidthTextBox_TextChanged"
                                                             IsEnabled="{Binding LockLineWidth, Converter={StaticResource BooleanInverterConverter}}"
                                                             ToolTip="Ð¨Ð¸Ñ€Ð¸Ð½Ð° Ð»Ð¸Ð½Ð¸Ð¸ (1-10)"
                                                             Margin="0,0,0,5"/>

                                                    <!-- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ð¾Ñ‡ÐµÐº -->
                                                    <CheckBox Grid.Row="14" 
                                                              Grid.Column="0"
                                                              IsChecked="{Binding LockPointCount}"
                                                              ToolTip="Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ð¾Ñ‡ÐµÐº"
                                                              VerticalAlignment="Center"
                                                              Content="ðŸ”’"
                                                              Margin="0,0,5,5"/>
                                                    <TextBlock Grid.Row="14" 
                                                               Grid.Column="1"
                                                               Text="Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ:"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,5,5"/>
                                                    <TextBox Grid.Row="14" 
                                                             Grid.Column="2"
                                                             Text="{Binding PointCount, UpdateSourceTrigger=PropertyChanged}"
                                                             TextChanged="FunctionPointCountTextBox_TextChanged"
                                                             IsEnabled="{Binding LockPointCount, Converter={StaticResource BooleanInverterConverter}}"
                                                             ToolTip="ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ð¾Ñ‡ÐµÐº Ð´Ð»Ñ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐ¸ (10-10000)"
                                                             Margin="0,0,0,5"/>
                                                                                </Grid>
                            </StackPanel>
                        </Expander.Content>
                    </Expander>
                </Grid>
            </Border>
        </DataTemplate>
    </ListBox.ItemTemplate>
</ListBox>
            </Border>
            
            </DockPanel>
        </Grid>
    </Grid>
</Window> 